<div class="bg-white p-6 rounded-lg shadow">
  <h2 class="text-2xl font-semibold mb-4 text-gray-800">Movimientos de Inventario</h2>

  <!-- Filtros -->
  <div class="flex flex-wrap gap-4 mb-6">
    <input
      type="number"
      placeholder="ID Producto"
      [(ngModel)]="filtroProductoId"
      class="border rounded px-3 py-2 w-40 focus:ring focus:ring-blue-300"
    />

    <input
      type="date"
      [(ngModel)]="fechaInicio"
      class="border rounded px-3 py-2 focus:ring focus:ring-blue-300"
    />
    <input
      type="date"
      [(ngModel)]="fechaFin"
      class="border rounded px-3 py-2 focus:ring focus:ring-blue-300"
    />

    <button
      (click)="filtrarPorProducto()"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
    >
      Buscar Producto
    </button>

    <button
      (click)="filtrarPorRango()"
      class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"
    >
      Filtrar por Rango
    </button>

    <button
      (click)="obtenerResumen()"
      class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition"
    >
      Ver Resumen
    </button>

    <button
      (click)="cargarMovimientos()"
      class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition"
    >
      Reset
    </button>
  </div>

  <!-- Tabla -->
  <div *ngIf="!cargando; else loading">
    <table class="w-full border-collapse">
      <thead class="bg-blue-100 text-gray-700">
        <tr>
          <th class="p-2 text-left">ID</th>
          <th class="p-2 text-left">Producto</th>
          <th class="p-2 text-left">Tipo</th>
          <th class="p-2 text-left">Cantidad</th>
          <th class="p-2 text-left">Usuario</th>
          <th class="p-2 text-left">Fecha</th>
        </tr>
      </thead>
      <tbody>
        @for (mov of movimientos; track mov.id) {
          <tr class="border-b hover:bg-gray-50">
            <td class="p-2">{{ mov.id }}</td>
            <td class="p-2">{{ mov.producto?.Nombre }}</td>
            <td class="p-2">{{ mov.tipo }}</td>
            <td class="p-2">{{ mov.cantidad }}</td>
            <td class="p-2">{{ mov.usuario?.Nombre }}</td>
            <td class="p-2">{{ mov.fecha | date: 'short' }}</td>
          </tr> 
        }
      </tbody>
    </table>
  </div>

  <ng-template #loading>
    <div class="text-center py-6 text-gray-500">Cargando movimientos...</div>
  </ng-template>

  <!-- Resumen -->
  <div *ngIf="resumen" class="mt-8 bg-gray-50 p-4 rounded">
    <h3 class="text-lg font-semibold mb-2 text-gray-700">Resumen del Producto</h3>
    <p><strong>Producto:</strong> {{ resumen.nombreProducto }}</p>
    <p><strong>Total Entradas:</strong> {{ resumen.totalEntradas }}</p>
    <p><strong>Total Salidas:</strong> {{ resumen.totalSalidas }}</p>
    <p><strong>Stock Actual:</strong> {{ resumen.stockActual }}</p>
  </div>
</div>
