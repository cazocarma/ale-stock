<div class="bg-white shadow-md rounded-lg p-6">
  <h2 class="text-xl font-semibold text-gray-700 mb-4">Gesti√≥n de Pedidos</h2>

  @if (cargando) {
    <p class="text-gray-500">Cargando pedidos...</p>
  } @else if (error) {
    <p class="text-red-600">{{ error }}</p>
  } @else {
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 text-sm text-left">
        <thead class="bg-blue-700 text-white uppercase text-xs">
          <tr>
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Fecha</th>
            <th class="px-4 py-2">Creado Por</th>
            <th class="px-4 py-2">Estado</th>
            <th class="px-4 py-2">Detalles</th>
            <th class="px-4 py-2 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (let pedido of pedidos; track pedido.id) {
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-2">{{ pedido.id }}</td>
              <td class="px-4 py-2">
                {{ pedido.fecha | date: 'short' }}
              </td>
              <td class="px-4 py-2">{{ pedido.creadoPor?.nombre }}</td>
              <td class="px-4 py-2">
                <span
                  class="px-2 py-1 rounded text-xs font-medium"
                  [ngClass]="{
                    'bg-green-200 text-green-700': pedido.estado === 'Aprobado',
                    'bg-yellow-200 text-yellow-700': pedido.estado === 'Pendiente',
                    'bg-red-200 text-red-700': pedido.estado === 'Rechazado'
                  }"
                >
                  {{ pedido.estado }}
                </span>
              </td>
              <td class="px-4 py-2">
                <ul class="list-disc ml-4">
                  @for (let det of pedido.detalles; track det.id) {
                    <li>
                      {{ det.producto?.marca }} {{ det.producto?.modelo }}
                      <span class="text-gray-500">x{{ det.cantidad }}</span>
                    </li>
                  }
                </ul>
              </td>
              <td class="px-4 py-2 text-center space-x-2">
                @if (rol === 'Coordinador' && pedido.estado === 'Pendiente') {
                  <button
                    (click)="aprobarPedido(pedido)"
                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded"
                  >
                    Aprobar
                  </button>
                  <button
                    (click)="rechazarPedido(pedido)"
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded"
                  >
                    Rechazar
                  </button>
                } @else if (rol === 'Bodega') {
                  <button
                    (click)="cambiarEstado(pedido)"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded"
                  >
                    Cambiar estado
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
